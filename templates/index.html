<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Cluster Visualization</title>
     <link rel="icon" href="../static/images/icon.png">

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="css/scrolling-nav.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/scrolling-nav.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css')}}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/dropzone/dropzone.css')}}">

  </head>

  <style>
      /*mudanca do css do layout de cada arquivo dentro do dropzone*/
      .dropzone .dz-preview .dz-image {
           border-radius: 20px;
           overflow: hidden;
           width: 25em;
           height: 5.5em;
           padding: 0.2em;
           position: relative;
           display: block;
           z-index: 10;
      }

      .dropzone .dz-preview.dz-file-preview .dz-image {
            border-radius: 10px;
            background: #000;
            background: linear-gradient(to bottom, #eee, #eee);
      }

      .dropzone .dz-preview .dz-details .dz-filename:hover span {
         border: 1px solid transparent;
         background-color: linear-gradient(to bottom, #eee, #eee);
       }

      .dropzone .dz-preview {
         position: relative;
         display: inline-block;
         vertical-align: top;
         margin: 0.2em;
         min-height: 100px;
      }

  </style>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">Cluster Visualization</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#usage">Usage</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><i class="fa fa-sign-in" aria-hidden="true"></i> Login</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="bg-primary text-white" id="uploaddataset">
      <div class="container text-center">
        <div class="row" align="center">
          <div class="col-lg-6 col-md-6 col-sm-12 mx-auto">
            <h1><b>Data Set Upload</b></h1>
            <!-- upload vai aqui -->
            <form action="#" class="dropzone dz-clickable" id="dropdataset" method="POST" enctype="multipart/form-data">
              <input type="hidden" name="name" value="dataset" />
              <div class="dz-message" data-dz-message style="color:grey;"><span><b>Drop files</b> or <b>click here</b> to upload</span><p style="font-size:80%;">The files must have a text format</p></div>
            </form>
                <button type="submit" class="btn btn-secondary" style="margin-top: 1em;" id="partitionchoicebutton" data-toggle="modal" data-target="#partitionchoice">Continue</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="bg-primary text-white hidden" id="uploadpartition">
      <div class="container text-center">
        <div class="row" align="center">
        <div class="col-lg-6 col-md-6 col-sm-12 mx-auto" id="right">
          <h1><b>Partitions</b></h1>
          <form action="#" class="dropzone dz-clickable"  id="droppartition" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="name" value="partition" />
            <div class="dz-message" data-dz-message style="color:grey;"><span><b>Drop files</b> or <b>click here</b> to upload</span><p style="font-size:80%;">The files must have a text format</p></div>
          </form>
              <button type="submit" class="btn btn-secondary" style="margin-top:1em;" id="continuepartition1">Continue</button>
          </div>
        </div>
      </div>
    </div>
  </section>

    <section id="clusteringDataSet" class="container hidden">
        <h2>Clustering</h2>
        <div class="row" style="margin-top:2em;">
          <div class="col-12">
               <div class="card">
               <div class="card-header">
                 <input type="checkbox" id="datawithbasic" data-toggle="collapse" data-target="#filter-data-basic">
                 <span>Basic Algorithms</span>
               </div>
               <div class="card-block collapse filter-panel container" style="margin: 0.5em" id="filter-data-basic">
                 <label for="chooseAll"><input type="checkbox" style="font-weight:bold;" id="chooseAll" onclick="checkAll(this)"> Select All</label>
                 <div id="checkboxDataSet">
                   <label for="singleLink"><input type="checkbox" id="singleLink"> Single Link</label>
                   <label for="averageLink"><input type="checkbox" id="averageLink"> Average Link</label>
                   <label for="centroidLink"><input type="checkbox" id="centroidLink"> Centroid Link</label>
                   <label for="completeLink"><input type="checkbox" id="completeLink"> Complete Link</label>
                   <label for="SNN"><input type="checkbox" id="SNN"> SNN</label>
                   <label for="kMeans"><input type="checkbox" id="kMeans"> KMeans</label>
                </div>
               </div>
             </div>
           </div>
        </div>
        <div class="row" style="margin-top:2em;">
          <div class="col-12">
               <div class="card">
                 <div class="card-header">
                   <input type="checkbox" id="datawithMocle" data-toggle="collapse" data-target="#filter-part-mocle">
                   <span>Mocle</span>
                 </div>
                 <div class="card-block collapse filter-panel container" style="margin: 0.5em" id="filter-part-mocle">
                   <div class="col-6">
                     <label for="selMetricDataSet">Choose Metrics:</label><br>
                     <select class="form-control" id="selMetricMocle">
                       <option value="E">Euclidean Distance</option>
                       <option value="P"></option>
                     </select>
                   </div>
                 </div>
              </div>
          </div>
        </div>
        <div class="row" style="margin-top:2em;">
          <div class="col-12" align="center">
            <button type="button" class="btn btn-primary" id="algdataset">Continue</button>
          </div>
        </div>
    </section>

    <section id="clusteringPartition" class="container hidden">
        <h2>Visualize</h2>

          <div class="row" style="margin-top:2em;">
          <div class="col-12">
               <div class="card">
                 <div class="card-header">
                   <input type="checkbox" id="partitionwithMocle" data-toggle="collapse" data-target="#filter-panel-mocle">
                   <span>Mocle</span>
                 </div>
                 <div class="card-block collapse filter-panel container" style="margin: 0.5em" id="filter-panel-mocle">
                   <div class="col-6">
                     <label for="selMetricPartition">Choose Metrics:</label><br>
                     <select class="form-control" id="selMetricMocle">
                       <option value="M">MCLA</option>
                       <option value="B">HBGF</option>
                     </select>
                   </div>
                   <div id="radiodataset" style="margin-top: 1em;">
                     <label class="radio"><input type="radio" name="opt" value="all"> All Clusters</label>
                     <label class="radio"><input type="radio" name="opt" value="dist"> Distinct Clusters</label>
                   </div>
                   <p style="margin-top: 1em;">Clusters size interval:</p>
                   <div class="row" style="margin-top: 1em;">
                     <!-- <div class="col-3"></div> -->
                     <label for="minSize" class="col-1 col-form-label">Minimum:</label>
                     <div class="col-2">
                       <input class="form-control" type="number" min="0" value="" id="minSize">
                     </div>
                     <label for="maxSize" class="col-1 col-form-label">Maximum:</label>
                     <div class="col-2">
                       <input class="form-control" type="number" min="0" value="" id="maxSize">
                     </div>
                     <div class="col-1"></div>
                   </div>
                 </div>
              </div>
          </div>
        </div>

        <div class="row" style="margin-top:2em;">
          <div class="col-12" align="center">
            <button type="button" class="btn btn-primary" id="finishpartition">View Results</button>
          </div>
        </div>
    </section>

    <section id="visualizedataset" class="container hidden">
        <h2>Visualize</h2>
        <div class="row">
          <div class="col-6">
            <label for="selMetric">Choose Metrics:</label><br>
            <select class="form-control" id="selMetricBasic">
              <option value="E">Euclidean Distance</option>
              <option value="P">Pearson Correlation</option>
            </select>
          </div>
        </div>
          <div id="radiodataset" style="margin-top: 1em;">
            <label class="radio"><input type="radio" name="opt" value="all"> All Clusters</label>
            <label class="radio"><input type="radio" name="opt" value="dist"> Distinct Clusters</label>
          </div>
          <p style="margin-top: 1em;">Clusters size interval:</p>
          <div class="row" style="margin-top: 1em;">
            <!-- <div class="col-3"></div> -->
            <label for="minSize" class="col-1 col-form-label">Minimum:</label>
            <div class="col-2">
              <input class="form-control" type="number" min="0" value="" id="minSize">
            </div>
            <label for="maxSize" class="col-1 col-form-label">Maximum:</label>
            <div class="col-2">
              <input class="form-control" type="number" min="0" value="" id="maxSize">
            </div>
            <div class="col-1"></div>
          </div>
          <div class="row" style="margin-top:2em;">
            <div class="col-12" align="center">
              <button type="button" class="btn btn-primary" id="finishdataset">View Results</button>
            </div>
          </div>
    </section>

    <section id="about">
      <div class="container">
        <div class="row">          <div class="col-lg-8 mx-auto">
            <h2>About</h2>
            <p class="lead">The tool</p>
            <p style="text-align: justify;">Ensemble methods for clustering take a collection
                of input partitions, produced for the same data set, and generate
                an ensemble partition that tries to preserve the information
                carried in this collective. Acceptance of the resulting partition(s)
                by decision makers can be a problem, due to the inherent
                complexity of ensemble techniques, and the associated lack of
                intuition on how a consensus has been derived from the original
                set of input partitions. This problem is exacerbated in multi-
                objective ensemble techniques, which generate a set of non-
                dominated consensus partitions. In this context, the selection of
                a final candidate clustering may require additional insight into
                the relationships between non-dominated output partitions.
                CVis has been developed as a general
                tool to provide insight into the relationship between any set
                of partitions of a given data set. In particular,
                the tool facilitates the visual analysis of the level of support
                identified for individual consensus clusters, which is helpful in
                explaining final solutions to a decision maker.</p>
            <p class="lead">Citing CVis</p>
            <p>If you publish material using CVis, please cite the following
            reference:</p>
            <p>Faceli, K., Sakata, T., and Handl, J. (2016). CVis - towards a
            novel visualization tool to explore the relationship between input
            and output partitions in multi-objective clustering ensembles.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="usage" class="bg-light">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Usage</h2>
          </div>
        </div>
        <div class="row row-divided" style="margin-top:1em;">
          <div class="col-lg-6 col-md-6 col-sm-12 mx-auto">
            <h4 style="text-decoration:underline; margin-bottom:2em;" align="center" id="left">Basic Algorithms</h2>
          </div>
          <div class="col-lg-6 col-md-6 col-sm-12 mx-auto">
            <h4 style="text-decoration:underline; margin-bottom:2em;" align="center">Mocle</h2>
            <h5 id="crossoverUsage"> Crossover </h5>
		          <ul>
		          	<li><div class="mdl-card__subtitle-text mdl-color-text--black"> MCLA - Meta-CLustering Algorithm as described in (1) </div></li>
		          	<li><div class="mdl-card__subtitle-text mdl-color-text--black"> HBGF - Hybrid Bipartite Graph Formulation as described in (3) </div></li>
		          </ul>
			       <h5 id="kConsensusUsage"> k of the consensus partition</h5>
		          	<ul>
		           		<li>Interval of k for choosing the number of clusters for the consensus partition when applying the crossover. The maximum number of clusters in each consensus partition is randomly  choosen  within this interval.</li>
		            </ul>
           	 <h5 id="datasetUsage"> Data set </h5>
		            <ul>
		            	<li>Data set in a text file format, where the first row contains columns labels and first column indicates the objects IDs.</li>
		            </ul>
            	<h5 id="initialPartitionsUsage"> Initial Partitions </h5>
              	<ul>
		              <li>Initial partitions represented as text files. Each file represents one partition and must contain two columns: the first column denotes the IDs of the objects (as in the data set) and the second column represents the labels of the clusters.</li>
		            </ul>
              <h5 id="nGenerationsUsage"> Number of Generations </h5>
		            <ul>
		            	<li>Maximum number of generations for running the genetic algorithm.</li>
		            </ul>
              <h5 id="nNearestNeighborsUsage"> Nearest Neighbors (%) </h5>
		             <ul>
		               <li>Percentage of the data set size used to define the number of nearest neighbor objects for calculating the connectivity.</li>
		             </ul>
	          </div>
          </div>
        </div>
    </section>

    <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Contact</h2>
            <p class="lead"><a href="http://lattes.cnpq.br/4451540730749377">Katti Faceli</a> (katti <i>at </i>ufscar <i>dot</i> br)</p>
            <p class="lead"><a href="http://lattes.cnpq.br/3560505262283874">Tiemi C. Sakata</a> (tiemi <i>at</i> ufscar <i>dot</i> br)</p>
            <p class="lead"><a href="http://personalpages.manchester.ac.uk/mbs/julia.handl/">Julia Handl</a> (Julia <i>dot</i> Handl <i>at</i> manchester <i>dot</i> ac <i>dot</i> uk)</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">The opinions, hypothesis,
        conclusions or recommendations contained in this material are the responsibility of the author(s) and do not necessarily reflect FAPESP's vision. (As opiniões, hipóteses e conclusões ou recomendações expressas neste material são de responsabilidade do autor(es) e não
        necessariamente refletem a visão da FAPESP)</p>
      </div>
      <!-- /.container -->
    </footer>

    <!-- Modal warning -->
    <div id="aviso_modal" class="modal fade" role="dialog" tabindex="-1">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Required</h4>
          </div>
          <div class="modal-body" style="background-color:tomato;">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" id="cleanErrors" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal choose partition -->
    <div id="partitionchoice" class="modal fade" role="dialog" tabindex="-1">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Partitions</h4>
          </div>
          <div class="modal-body">
            <p>Do you want to include partitions to the visualization?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" id="refusepartition" data-dismiss="modal">No</button>
            <button type="button" class="btn btn-default" id="includepartition" data-dismiss="modal">Yes</button>
          </div>
        </div>
      </div>
    </div>


      <!-- Bootstrap core JavaScript -->
      <script type="text/javascript" src="{{url_for('static', filename='vendor/jquery/jquery.min.js')}}"></script>
      <script type="text/javascript" src="{{url_for('static', filename='vendor/popper/popper.min.js')}}"></script>
      <script type="text/javascript" src="{{url_for('static', filename='vendor/bootstrap/js/bootstrap.min.js')}}"></script>

      <!-- Plugin JavaScript -->
      <script type="text/javascript" src="{{url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js')}}"></script>

      <!-- Custom JavaScript for this theme -->
      <script type="text/javascript" src="{{url_for('static', filename='js/scrolling-nav.js')}}"></script>

      <script src="{{url_for('static', filename='vendor/dropzone/dropzone.js')}}"></script>
      <!-- <script src="{{url_for('static', filename='vendor/dropzone/dropzone.min.js')}}"></script> -->

    <script type="text/javascript">

      $(document).ready(function(){
        $("input").val("");
        $(".hidden").hide();
        $("#partitionchoicebutton").prop("disabled",true);
      });

      Dropzone.autoDiscover = false;

        var myDropzone1 = new Dropzone(document.getElementById("dropdataset"), {
          acceptedFiles: '.txt',
          addRemoveLinks: true,
          maxFiles: 1,
          thumbnailWidth: 500,
          autoProcessQueue: false,

          init: function() {
            this.on("sending", function(file, xhr, formData){
                formData.append("selAlgorithm", $("#selAlgorithm").val());
                formData.append("selMetric", $("#selMetric").val());
                formData.append("allordist", $("#radiodataset input:checked").val());
                formData.append("minSize", $("#minSize").val());
                formData.append("maxSize", $("#maxSize").val());
            }),
            this.on("addedfile", function(event) {
                $("#partitionchoicebutton").prop("disabled",false);           
            }),
            this.on("removedfile", function(event) {
                $("#partitionchoicebutton").prop("disabled",true);           
            });
          } 
            
        });


        function checkAll(bx){
          var cbs = $('#checkboxDataSet input');
          for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox') {
              cbs[i].checked = bx.checked;
            }
          }
        }

        $('').click(function(){
          var error = false;
          if($('#datawithbasic:checked')){
            if($('#checkboxDataSet input:checked').length == 0){
              $('#aviso_modal .modal-body').append('<p>You selected Basic Algorithms, you should choose at least one.</p>');
              error = true;
            }
            if($("#maxSize").val() != "" && $("#maxSize").val() < $("#minSize").val()){
              $("#aviso_modal .modal-body").append("<p>Maximum size must be higher than minimum size!</p>");
              error = true;
            }
            if($("#radiodataset input:checked").length == 0){
              $("#aviso_modal .modal-body").append("<p>Choose the visualization between all clusters or distinct clusters, please.</p>");
            }
          }
          if($('#datawithMocle:checked')){
            
          }
        });

        $('#partitionchoice #refusepartition').click(function(){
          $('#clusteringDataSet').show();
          $('html,body').animate({
            scrollTop: $("#clusteringDataSet").offset().top},
            'slow');
          $("#partitionchoicebutton").prop("disabled",true);
        });

        $('#partitionchoice #includepartition').click(function(){
          $('#uploadpartition').show();
          $('html,body').animate({
            scrollTop: $('#uploadpartition').offset().top},
            'slow');
            $("#partitionchoicebutton").prop("disabled",true);
        });

        var myDropzone2 = new Dropzone(document.getElementById("droppartition"), {
          acceptedFiles: '.clu',
          addRemoveLinks: true,
          thumbnailWidth: 500,
          autoProcessQueue: false,

          init: function() {
            this.on("sending", function(file, xhr, formData){
                formData.append("allordist", $("#radiopartition input:checked").val());
                formData.append("minSize", $("#minPartition").val());
                formData.append("maxSize", $("#maxPartition").val());
            });
          }
        });

        $('#continuepartition2').click(function(){
          // // verifica se o valor maximo é maior que valor minimo e se os radio buttons estão pressionados
            // if($("#maxSize").val() != "" && $("#maxSize").val() < $("#minSize").val() || $("#radiodataset input:checked").length == 0){
            //   if($("#maxSize").val() != "" && $("#maxSize").val() < $("#minSize").val()){
            //     $("#aviso_modal #erro1").html("Maximum size must be higher than minimum size!");
            //   }
            //   if($("#radiodataset input:checked").length == 0){
            //     $("#aviso_modal #erro2").html("Choose the visualization between all clusters or distinct clusters, please.");
            //   }
          //     $("#aviso_modal").modal("show");
          //   }
          // else{
          //   myDropzone1.processQueue();
          // }
        });

        // isso faz com que carreguem mais de 2 arquivos por vez
        myDropzone1.on('success', myDropzone1.processQueue.bind(myDropzone1));
        myDropzone2.on('success', myDropzone2.processQueue.bind(myDropzone2));

        $("#cleanErrors").click(function(){
          $("#aviso_modal #erro1").html("");
          $("#aviso_modal #erro2").html("");
        });

    </script>

  </body>
</html>
